<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>digital-book-store-ui documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>
          <script>
               // Blocking script to avoid flickering dark mode
               // Dark mode toggle button
               var useDark = window.matchMedia('(prefers-color-scheme: dark)');
               var darkModeState = useDark.matches;
               var $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               var $darkModeToggles = document.querySelectorAll('.dark-mode-switch');
               var darkModeStateLocal = localStorage.getItem('compodoc_darkmode-state');

               function checkToggle(check) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].checked = check;
                    }
               }

               function toggleDarkMode(state) {
                    if (window.localStorage) {
                         localStorage.setItem('compodoc_darkmode-state', state);
                    }

                    checkToggle(state);

                    const hasClass = document.body.classList.contains('dark');

                    if (state) {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.add('dark');
                         }
                         if (!hasClass) {
                              document.body.classList.add('dark');
                         }
                    } else {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.remove('dark');
                         }
                         if (hasClass) {
                              document.body.classList.remove('dark');
                         }
                    }
               }

               useDark.addEventListener('change', function (evt) {
                    toggleDarkMode(evt.matches);
               });
               if (darkModeStateLocal) {
                    darkModeState = darkModeStateLocal === 'true';
               }
               toggleDarkMode(darkModeState);
          </script>

        <div class="navbar navbar-default navbar-fixed-top d-md-none p-0">
               <div class="d-flex">
                    <a href="../" class="navbar-brand">digital-book-store-ui documentation</a>
                    <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
               </div>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="d-none d-md-block menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">













<ol class="breadcrumb">
  <li class="breadcrumb-item">Interfaces</li>
  <li class="breadcrumb-item"
  >
  UserDetails</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a href="#info" 
                class="nav-link"
                class="nav-link active"
                role="tab" id="info-tab" data-bs-toggle="tab" data-link="info">Info</a>
        </li>
        <li class="nav-item">
            <a href="#source" 
                class="nav-link"
                
                role="tab" id="source-tab" data-bs-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/user-customer/user/user-profile/user-profile.component.ts</code>
        </p>




        <section data-compodoc="block-index">
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#error" 
>
                                            error
                                        </a>
                                </li>
                                <li>
                                        <a href="#id" 
>
                                            id
                                        </a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#message" 
>
                                            message
                                        </a>
                                </li>
                                <li>
                                        <a href="#name" 
>
                                            name
                                        </a>
                                </li>
                                <li>
                                        <a href="#phoneNumber" 
>
                                            phoneNumber
                                        </a>
                                </li>
                                <li>
                                        <a href="#profileImage" 
>
                                            profileImage
                                        </a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#statusCode" 
>
                                            statusCode
                                        </a>
                                </li>
                                <li>
                                        <a href="#userId" 
>
                                            userId
                                        </a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section data-compodoc="block-properties">
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="error"></a>
                                        <span class="name "><b>error</b>
                                            <a href="#error">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>error:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="id"></a>
                                        <span class="name "><b>id</b>
                                            <a href="#id">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>id:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="message"></a>
                                        <span class="name "><b>message</b>
                                            <a href="#message">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>message:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="name"></a>
                                        <span class="name "><b>name</b>
                                            <a href="#name">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>name:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="phoneNumber"></a>
                                        <span class="name "><b>phoneNumber</b>
                                            <a href="#phoneNumber">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>phoneNumber:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="profileImage"></a>
                                        <span class="name "><b>profileImage</b>
                                            <a href="#profileImage">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>profileImage:     <code>string | null</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>string | null</code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="statusCode"></a>
                                        <span class="name "><b>statusCode</b>
                                            <a href="#statusCode">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>statusCode:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="userId"></a>
                                        <span class="name "><b>userId</b>
                                            <a href="#userId">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>userId:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Component, OnInit } from &#x27;@angular/core&#x27;;
import { FormBuilder, FormGroup, Validators } from &#x27;@angular/forms&#x27;;
import { Router } from &#x27;@angular/router&#x27;;
import { UserService } from &#x27;../service/user.service&#x27;;
import { catchError, of } from &#x27;rxjs&#x27;;

interface Review {
  bookTitle: string;
  rating: number;
  comment: string;
}

interface UserDetails {
  id: number;
  userId: number;
  name: string;
  phoneNumber: string;
  profileImage: string | null; // Base64 encoded image
  statusCode?: number;
  message?: string;
  error?: string;
}

@Component({
  selector: &#x27;app-user-profile&#x27;,
  templateUrl: &#x27;./user-profile.component.html&#x27;,
  styleUrls: [&#x27;./user-profile.component.sass&#x27;],
  standalone: false
})
export class UserProfileComponent implements OnInit {
  activeTab: &#x27;details&#x27; | &#x27;wallet&#x27; | &#x27;orders-reviews&#x27; | &#x27;support&#x27; | &#x27;close-account&#x27; &#x3D; &#x27;details&#x27;;
  userId: number | null &#x3D; null;
  userDetails: UserDetails | null &#x3D; null; // To hold fetched user details
  walletBalance: number &#x3D; 0;
  userReviews: Review[] &#x3D; [];
  isSidebarExpanded: boolean &#x3D; false;
  isEditingDetails: boolean &#x3D; false;
  showBalance: boolean &#x3D; false;
  showSimulatePaymentPopup: boolean &#x3D; false;
  simulatePaymentSuccess: boolean &#x3D; false;
  simulatePaymentError: boolean &#x3D; false;
  simulatePaymentErrorMessage: string &#x3D; &#x27;&#x27;;
  topUpAmount: number | null &#x3D; null;

  profileForm: FormGroup;
  passwordForm: FormGroup;
  simulatePaymentForm: FormGroup;
  selectedFile: File | null &#x3D; null; // To hold the selected image file
  profileImagePreview: string | ArrayBuffer | null &#x3D; null; // For image preview

  updateSuccessMessage: string &#x3D; &#x27;&#x27;;
  updateErrorMessage: string &#x3D; &#x27;&#x27;;
  passwordSuccessMessage: string &#x3D; &#x27;&#x27;;
  passwordErrorMessage: string &#x3D; &#x27;&#x27;;
  closeAccountMessage: string &#x3D; &#x27;&#x27;;

  constructor(
    private fb: FormBuilder,
    private router: Router,
    private userService: UserService
  ) {
    this.profileForm &#x3D; this.fb.group({
      name: [&#x27;&#x27;, Validators.required],
      phoneNumber: [&#x27;&#x27;, [Validators.required, Validators.pattern(&#x27;^[0-9-+\\s()]*$&#x27;)]], // Basic phone number validation
      profileImage: [null] // We&#x27;ll handle this separately
    });
    this.passwordForm &#x3D; this.fb.group({
      currentPassword: [&#x27;&#x27;, Validators.required],
      newPassword: [&#x27;&#x27;, [Validators.required, Validators.minLength(6)]],
      confirmPassword: [&#x27;&#x27;, Validators.required]
    }, { validators: this.passwordMatchValidator });
    this.simulatePaymentForm &#x3D; this.fb.group({
      paymentMethod: [&#x27;upi&#x27;],
      upiId: [&#x27;&#x27;, Validators.required],
      cardNumber: [&#x27;&#x27;, [Validators.minLength(16), Validators.maxLength(16)]],
      expiry: [&#x27;&#x27;, [Validators.pattern(&#x27;^(0[1-9]|1[0-2])\\/?([0-9]{2})$&#x27;)]],
      cvv: [&#x27;&#x27;, [Validators.minLength(3), Validators.maxLength(4)]],
      simulateAmount: [0, Validators.required]
    });
  }

  ngOnInit(): void {
    this.userId &#x3D; parseInt(sessionStorage.getItem(&#x27;userId&#x27;) || &#x27;0&#x27;, 10);
    if (this.userId) {
      this.loadUserProfile();
      this.loadWalletBalance();
      this.loadUserReviews();
    } else {
      this.router.navigate([&#x27;/login&#x27;]);
    }
  }

  toggleSidebar() {
    this.isSidebarExpanded &#x3D; !this.isSidebarExpanded;
  }

  setActiveTab(tab: &#x27;details&#x27; | &#x27;wallet&#x27; | &#x27;orders-reviews&#x27; | &#x27;support&#x27; | &#x27;close-account&#x27;) {
    this.activeTab &#x3D; tab;
    this.updateSuccessMessage &#x3D; &#x27;&#x27;;
    this.updateErrorMessage &#x3D; &#x27;&#x27;;
    this.passwordSuccessMessage &#x3D; &#x27;&#x27;;
    this.passwordErrorMessage &#x3D; &#x27;&#x27;;
    this.closeAccountMessage &#x3D; &#x27;&#x27;;
    this.simulatePaymentSuccess &#x3D; false;
    this.simulatePaymentError &#x3D; false;
    this.simulatePaymentErrorMessage &#x3D; &#x27;&#x27;;
    this.isEditingDetails &#x3D; false;
    this.showSimulatePaymentPopup &#x3D; false;
    this.topUpAmount &#x3D; null;
    this.profileImagePreview &#x3D; null;  
    this.selectedFile &#x3D; null;
  }

  loadUserProfile() {
    this.userService.getUserDetails(this.userId!).pipe(
      catchError(error &#x3D;&gt; {
        console.error(&#x27;Error loading user details:&#x27;, error);
        return of(null);
      })
    ).subscribe(userDetails &#x3D;&gt; {
      this.userDetails &#x3D; userDetails;
      if (userDetails) {
        this.profileForm.patchValue({
          name: userDetails.name,
          phoneNumber: userDetails.phoneNumber,
          // profileImage: userDetails.profileImage // We don&#x27;t patch the image in the form
        });
        // Check if userDetails.profileImage exists and is a string before proceeding
        if (userDetails.profileImage &amp;&amp; typeof userDetails.profileImage &#x3D;&#x3D;&#x3D; &#x27;string&#x27; &amp;&amp; !userDetails.profileImage.startsWith(&#x27;data:&#x27;)) {
          // Assuming the backend returns the image in a common format like JPEG
          this.userDetails!.profileImage &#x3D; userDetails?.profileImage ? &#x60;data:image/jpeg;base64,${userDetails.profileImage}&#x60; : null;
          // You might need to adjust &#x27;image/jpeg&#x27; based on your actual backend image format
        } else if (userDetails.profileImage &amp;&amp; typeof userDetails.profileImage !&#x3D;&#x3D; &#x27;string&#x27;) {
          console.warn(&#x27;Profile image data is not a string:&#x27;, userDetails.profileImage);
          if (this.userDetails) {
            this.userDetails.profileImage &#x3D; null; // Or handle it as needed
          }
        }
      }
    });
  }

  handleFileInput(event: any) {
    this.selectedFile &#x3D; event.target.files[0];
    if (this.selectedFile) {
      const reader &#x3D; new FileReader();
      reader.onload &#x3D; (e) &#x3D;&gt; {
        this.profileImagePreview &#x3D; e.target?.result ?? null;
      };
      reader.readAsDataURL(this.selectedFile);
    } else {
      this.profileImagePreview &#x3D; this.userDetails?.profileImage || null; 
    }
  }

  updateProfile() {
    if (this.profileForm.valid &amp;&amp; this.userId) {
      const formData &#x3D; new FormData();
      formData.append(&#x27;name&#x27;, this.profileForm.value.name);
      formData.append(&#x27;phoneNumber&#x27;, this.profileForm.value.phoneNumber);
      if (this.selectedFile) {
        formData.append(&#x27;profileImage&#x27;, this.selectedFile, this.selectedFile.name);
      }

      this.userService.updateUserDetails(this.userId, formData).pipe( // Use the new service method
        catchError(error &#x3D;&gt; {
          console.error(&#x27;Error updating profile:&#x27;, error);
          this.updateErrorMessage &#x3D; error?.message || &#x27;Failed to update profile.&#x27;;
          return of(null);
        })
      ).subscribe(response &#x3D;&gt; {
        if (response?.statusCode &#x3D;&#x3D;&#x3D; 200) {
          this.updateSuccessMessage &#x3D; response.message || &#x27;Profile updated successfully!&#x27;;
          this.userDetails &#x3D; response; // Update the displayed details
          sessionStorage.setItem(&#x27;name&#x27;, response.name || &#x27;&#x27;);
          this.isEditingDetails &#x3D; false;
          this.selectedFile &#x3D; null;
          this.profileImagePreview &#x3D; null;
          // After successful update, ensure the image URL is correctly formatted
          if (this.userDetails?.profileImage &amp;&amp; typeof this.userDetails.profileImage &#x3D;&#x3D;&#x3D; &#x27;string&#x27; &amp;&amp; !this.userDetails.profileImage.startsWith(&#x27;data:&#x27;)) {
            this.userDetails.profileImage &#x3D; &#x60;data:image/jpeg;base64,${this.userDetails.profileImage}&#x60;;
            // Adjust &#x27;image/jpeg&#x27; if necessary
          } else if (this.userDetails?.profileImage &amp;&amp; typeof this.userDetails.profileImage !&#x3D;&#x3D; &#x27;string&#x27;) {
            console.warn(&#x27;Updated profile image data is not a string:&#x27;, this.userDetails.profileImage);
            this.userDetails.profileImage &#x3D; null; // Or handle it as needed
          }
        } else {
          this.updateErrorMessage &#x3D; response?.message || &#x27;Failed to update profile.&#x27;;
        }
      });
    }
  }

    changePassword() {
        if (this.passwordForm.valid) {
            this.userService.changePassword(this.userId!, this.passwordForm.value).pipe(
                catchError(error &#x3D;&gt; {
                    console.error(&#x27;Error changing password:&#x27;, error);
                    this.passwordErrorMessage &#x3D; error?.message || &#x27;Failed to change password.&#x27;;
                    return of(null);
                })
            ).subscribe(response &#x3D;&gt; {
                if (response?.statusCode &#x3D;&#x3D;&#x3D; 200) {
                    this.passwordSuccessMessage &#x3D; response.message || &#x27;Password changed successfully!&#x27;;
                    this.passwordForm.reset();
                } else {
                    this.passwordErrorMessage &#x3D; response?.message || &#x27;Failed to change password.&#x27;;
                }
            });
        }
    }

    passwordMatchValidator(formGroup: FormGroup) {
        const newPasswordControl &#x3D; formGroup.controls[&#x27;newPassword&#x27;];
        const confirmPasswordControl &#x3D; formGroup.controls[&#x27;confirmPassword&#x27;];

        if (!newPasswordControl || !confirmPasswordControl) {
            return null;
        }

        if (confirmPasswordControl.value &#x3D;&#x3D;&#x3D; &#x27;&#x27;) {
            return null;
        }

        if (newPasswordControl.value !&#x3D;&#x3D; confirmPasswordControl.value) {
            return { mismatch: true };
        }

        return null;
    }

    loadWalletBalance() {
        if (this.userId) {
            this.userService.getUserCredit(this.userId).pipe(
                catchError(error &#x3D;&gt; {
                    console.error(&#x27;Error loading wallet balance:&#x27;, error);
                    return of({ credits: 0 });
                })
            ).subscribe(creditInfo &#x3D;&gt; {
                this.walletBalance &#x3D; creditInfo?.credits || 0;
            });
        }
    }

    setTopUpAmount(amount: number) {
        this.topUpAmount &#x3D; amount;
    }

    populateSimulateAmount() {
        this.simulatePaymentForm.patchValue({ simulateAmount: this.topUpAmount });
        // Reset UPI/Credit Card specific fields when the popup opens
        this.simulatePaymentForm.patchValue({ upiId: &#x27;&#x27; });
        this.simulatePaymentForm.patchValue({ cardNumber: &#x27;&#x27; });
        this.simulatePaymentForm.patchValue({ expiry: &#x27;&#x27; });
        this.simulatePaymentForm.patchValue({ cvv: &#x27;&#x27; });
        this.simulatePaymentForm.markAsUntouched(); // Reset touched state for validation
    }

    simulateAddFunds() {
        if (this.simulatePaymentForm.valid &amp;&amp; this.userId) {
            const amount &#x3D; this.simulatePaymentForm.value.simulateAmount;
            this.userService.addCredits(this.userId, amount).pipe(
                catchError(error &#x3D;&gt; {
                    console.error(&#x27;Error adding funds:&#x27;, error);
                    this.simulatePaymentError &#x3D; true;
                    this.simulatePaymentSuccess &#x3D; false;
                    this.simulatePaymentErrorMessage &#x3D; error?.error?.message || &#x27;Failed to add funds.&#x27;;
                    return of(null);
                })
            ).subscribe(response &#x3D;&gt; {
                if (response?.statusCode &#x3D;&#x3D;&#x3D; 200 || response?.statusCode &#x3D;&#x3D;&#x3D; 201) {
                    this.simulatePaymentSuccess &#x3D; true;
                    this.simulatePaymentError &#x3D; false;
                    this.loadWalletBalance();
                    setTimeout(() &#x3D;&gt; {
                        this.simulatePaymentSuccess &#x3D; false;
                        this.showSimulatePaymentPopup &#x3D; false;
                        this.topUpAmount &#x3D; null;
                    }, 3000);
                } else {
                    this.simulatePaymentError &#x3D; true;
                    this.simulatePaymentSuccess &#x3D; false;
                    this.simulatePaymentErrorMessage &#x3D; response?.message || &#x27;Failed to add funds.&#x27;;
                }
            });
        } else {
            this.simulatePaymentError &#x3D; true;
            this.simulatePaymentSuccess &#x3D; false;
            this.simulatePaymentErrorMessage &#x3D; &#x27;Please enter a valid amount and payment details.&#x27;;
        }
    }

    closeSimulatePaymentPopup() {
        this.showSimulatePaymentPopup &#x3D; false;
        this.simulatePaymentSuccess &#x3D; false;
        this.simulatePaymentError &#x3D; false;
        this.simulatePaymentErrorMessage &#x3D; &#x27;&#x27;;
        this.simulatePaymentForm.reset();
        this.simulatePaymentForm.patchValue({ paymentMethod: &#x27;upi&#x27;, simulateAmount: 0 });
        this.topUpAmount &#x3D; null;
    }

    loadUserReviews() {
        this.userReviews &#x3D; [
            { bookTitle: &#x27;The Great Gatsby&#x27;, rating: 4, comment: &#x27;A classic!&#x27; },
            { bookTitle: &#x27;To Kill a Mockingbird&#x27;, rating: 5, comment: &#x27;A powerful story.&#x27; }
        ];
    }

    confirmCloseAccount() {
        if (confirm(&#x27;Are you sure you want to close your account? This action is irreversible.&#x27;)) {
            this.userService.closeAccount(this.userId!).pipe(
                catchError(error &#x3D;&gt; {
                    console.error(&#x27;Error closing account:&#x27;, error);
                    this.closeAccountMessage &#x3D; error?.message || &#x27;Failed to close account.&#x27;;
                    return of(null);
                })
            ).subscribe(response &#x3D;&gt; {
                if (response?.statusCode &#x3D;&#x3D;&#x3D; 200) {
                    this.closeAccountMessage &#x3D; response.message || &#x27;Account closed successfully.&#x27;;
                    setTimeout(() &#x3D;&gt; this.router.navigate([&#x27;/&#x27;]), 3000);
                } else {
                    this.closeAccountMessage &#x3D; response?.message || &#x27;Failed to close account.&#x27;;
                }
            });
        }
    }
}</code></pre>
    </div>
</div>








                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'UserDetails.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script>
               $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               checkToggle(darkModeState);
               if ($darkModeToggleSwitchers.length > 0) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].addEventListener('change', function (event) {
                              darkModeState = !darkModeState;
                              toggleDarkMode(darkModeState);
                         });
                    }
               }
          </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
